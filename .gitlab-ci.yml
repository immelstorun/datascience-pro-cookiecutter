stages:
  - test
  - sync

test_job:
  stage: test
  script:
    - echo "Hello, GitLab Runner!"

sync_with_github:
  stage: sync
  variables:
    GIT_STRATEGY: clone
  before_script:
    - mkdir -p ~/.ssh
    - chmod 700 ~/.ssh
    - echo "$SSH_PRIVATE_KEY" | tr -d '\r' > ~/.ssh/id_ed25519
    - chmod 600 ~/.ssh/id_ed25519
    - git config --global user.name "GitLab CI"
    - git config --global user.email "gitlab-ci@example.com"
    - eval "$(ssh-agent -s)"
    - ssh-add ~/.ssh/id_ed25519
    - ssh-keyscan github.com >> ~/.ssh/known_hosts
  script:
    - git remote add github git@github.com:immelstorun/datascience-pro-cookiecutter.git
    - git push github HEAD:main --force
  only:
    - main